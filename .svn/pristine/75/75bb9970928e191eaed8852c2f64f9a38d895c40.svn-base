package group9.CollageWindow;

import group9.Piccollage;
import group9.CustomComponents.CustomJPanel;
import group9.CustomComponents.PreviewImageJPanel;
import group9.ButtonHandling.*;
import group9.utils.Utils;

import javax.swing.*;
import java.awt.*;
import java.io.IOException;

public class CollagePage {
    private Piccollage theApp;
    private CustomJPanel mainJPanel;
    private PreviewImageJPanel previewCollageJPanel;
    private int index = 0;
    private JScrollPane s;

    public void setCollagePreviewImage(int index) {
        if(theApp.getGeneratedCollages().size() > 0){
            this.index += index;
            if (this.index < 0)
                this.index = theApp.getGeneratedCollages().size() - 1;
            else
                this.index = this.index % theApp.getGeneratedCollages().size();
            previewCollageJPanel.setImage(Utils.resizeImage(
                    theApp.getGeneratedCollages().get(this.index),
                    previewCollageJPanel.getWidth(),
                    previewCollageJPanel.getHeight()));
            previewCollageJPanel.revalidate();
            previewCollageJPanel.repaint();
            s.repaint();
            s.revalidate();
        }else{
            previewCollageJPanel.setImage(null);
        }
    }

    public int getCollagePreviewIndex(){
        return index;
    }

    public JPanel getPreviewCollageJPanel(){return previewCollageJPanel;}

    public CollagePage(Piccollage theApp) throws IOException {
        this.theApp = theApp;

        mainJPanel = new CustomJPanel();
        GridBagConstraints c = mainJPanel.getConstraints();

        //Home button
        JButton homeBtn = mainJPanel.createButton("home");
        c.gridx = 0;
        c.gridy = 0;
        mainJPanel.add(homeBtn, c); //Adding 'home' button to cell (0, 0) in main JPanel

        //Setting title for the application
        c.gridx = 1;
        c.gridy = 0;
        JLabel t = new JLabel("Piccollage", SwingConstants.CENTER);
        t.setFont(new Font("Helvetica", Font.BOLD, 40));
        mainJPanel.add(t, c);

        //help button
        JButton helpBtn = mainJPanel.createButton("help");
        c.gridx = 2;
        c.gridy = 0;
        mainJPanel.add(helpBtn, c);  //Adding 'help' button to cell (2, 0)

        //previous collage and next collage buttons
        JButton previousCollageBtn = mainJPanel.createButton("previous collage");
        JButton nextCollageBtn = mainJPanel.createButton("next collage");

        //Adding 'next collage' and 'previous collage' buttons to a JPanel
        JPanel nextPreviousButtons = new JPanel();
        nextPreviousButtons.setBackground(Color.WHITE);
        nextPreviousButtons.add(previousCollageBtn);
        nextPreviousButtons.add(nextCollageBtn);
        c.gridx = 1;
        c.gridy = 2;
        mainJPanel.add(nextPreviousButtons, c); //Adding 'nextPrevious' JPanel to cell (1, 2) in main JPanel

        //delete collage button
        JButton deleteBtn = mainJPanel.createButton("delete");
        c.gridx = 2;
        c.gridy = 2;
        mainJPanel.add(deleteBtn, c);  //Adding 'delete' button to cell (2, 2)

        //save collage button
        JButton saveBtn = mainJPanel.createButton("save");
        c.gridx = 0;
        c.gridy = 2;
        mainJPanel.add(saveBtn, c);  //Adding 'save' button to cell (0, 2)

        //Adding image to Scrollable area
        previewCollageJPanel = new PreviewImageJPanel(new JLabel());
        s = new JScrollPane(previewCollageJPanel);
        s.setMinimumSize(new Dimension(800, 900));
        //previewCollageJPanel.setMaximumSize(new Dimension(collage.getWidth(), collage.getHeight()));

        //Adding collage image to cell (1, 1)
        c.weightx = 0.5;
        c.weighty = 0.5;
        c.gridx = 1;
        c.gridy = 1;
        mainJPanel.add(s, c);

        c.gridx = 0;
        c.gridy = 1;
        mainJPanel.add(new CollageOptions(), c);
        c.gridx = 2;
        c.gridy = 1;
        mainJPanel.add(new CollageOptions(), c);

        homeBtn.addActionListener(new BackToHomepageButtonHandler(theApp));
        previousCollageBtn.addActionListener(new PreviousCollageButtonHandler(this));
        saveBtn.addActionListener(new SaveCollageButtonHandler(previewCollageJPanel.getImage()));
        nextCollageBtn.addActionListener(new NextCollageButtonHandler(this));
        helpBtn.addActionListener(new HelpButtonHandler(theApp));
        deleteBtn.addActionListener(new DiscardCollageButtonHandler(theApp, previewCollageJPanel.getImage()));
    }

    public JPanel getCollagePageJPanel(){
        return mainJPanel;
    }
}